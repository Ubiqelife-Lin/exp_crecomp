# 被験者実験手順サイト
宇都宮大学大学院工学研究科　山科和史


## はじめに
周囲の状況に応じて行動する**自律移動型ロボット**は知的画像処理などの非常に複雑かつ膨大な計算を行う必要があります。
高い処理性能が要求されているの対し自律移動型ロボットのバッテリ駆動のため，低消費電力化の観点から処理性能の高いプロセッサは搭載できず処理性能不足となる問題があります。  

我々はこうした問題を解決するために，ロボット制御のプラットフォームとして電力性能比が高い**FPGA(Field Programmable Gate Array)**に注目しています。しかし，FPGAにおける開発は一般のプログラミング言語(CやJava)に比べて**HDL(Hardware Description Language)**による開発となるため，開発者への負担が大変大きいです。このような問題を解決し，FPGAを容易にロボットへ導入するため，ロボットシステムの開発運用のためのソフトウェアプラットフォームである**ROS**に準拠した，FPGAのソフトウェアコンポーネント化を提案しています。  

実験では**cReComp**というコンポーネント自動設計ツールを使用し、**FPGA向けの回路のコンポーネント化**を行います。またコンポーネントの設計について，被験者のみなさんに評価していただきます。 

**本実験の専門用語の詳しい解説については[別途資料](support_doc.md)をご参照ください。**  

##自動コンポーネント化ツール cReComp
<font color="red">**cReComp**</font>はFPGAの回路をもとに，自動的にROS準拠のコンポーネントを生成できる設計ツールです．  

cReCompではCPUとFPGAが同一チップに搭載されてある**Programmable SoC**をいうデバイスで動作するコンポーネントを生成します．このようなデバイスではCPUとFPGAの間にデータ通信を行うためのバスシステムが用意されてあり，ソフトウェアからFPGAへ，もしくFPGAからソフトウェアへのデータのやりとりが可能です．しかし，この通信をを使用するための回路設計などが大変難しいです．cReCompでは通信路の設計や回路記述を含めて，コンポーネントの生成が可能です．

<center>
<img src="pic/crecomp.png" width ="70%" >
</center>

上の図はcReCompのコンポーネント生成モデルです．cReCompに与える入力はコンポーネント化の対象となる回路**ユーザロジック**と通信のルールを決めるための設定ファイルです．ここでいう「通信ルール」はFPGAがCPUから何回データを受信するかなどのことです．コンポーネント化のための設定ファイルはプログラミング言語のPythonによって記述する事ができます．

また，cReCompからの出力は，CPUとFPGAのデータ通信制御を担うハードウェア（図中の制御回路）と，その回路をラップするROS準拠のソフトウェアです．cReCompではこのようなユーザロジック（FPGA）とCPUがデータ通信するための，ハードウェアとソフトウェアからなる**インターフェイス**が生成されます．このインターフェイスが付いたコンポーネントをROS準拠FPGAコンポーネントとします．

## 実験の目的
- cReCompを用いることでハードウェアの自動コンポーネント化する開発工程を体験する
- 生成したコンポーネントを動作させ、応用的な開発を行う
- cReCompを用いた場合と用いない場合の比較をする

## 実験内容
#### cReCompを用いたハードウェアのコンポーネント化とROSシステムにおける開発

本実験では大きく分けて5つのStepがあります。

1. cReCompとを用いてVerilog HDLで記述されたハードウェア回路をコンポーネント化する
- ROS準拠FPGAコンポーネントのハードウェアの作成
- コンポーネントを用いてモータの制御をする
- コンポーネントを用いて応用開発
- FPGAとCPUをつなぐインターフェイスの記述体験

5つの項目は時間測定をしながら作業していただきます。  
Step5が終了した時点でアンケート記入をしていただきます。  

## 実験の注意事項

- **実験中の休憩は自由に取っていただいてかまいません。また，途中で気分が悪くなった場合もお申し付けください。**
- **実験中の質問や被験者同士の質問・会話は原則可能ですが，できる限り本サイトを元に実験を進めてください。**
- **質問や会話に関する議事録を取らせていただきます(匿名)。**
- **実験の各項目が終了したら時間計測用紙へ時間の記入をお願いします。**

## 実験手順
[Step1: cReCompを用いてVerilog HDLで記述されたハードウェア回路をコンポーネント化](componentize.md)  
[Step2: ROS準拠FPGAコンポーネントのハードウェアの作成](synthesis.md)  
[Step3: コンポーネントを用いてモータの制御](ros_verification.md)  
[Step4: コンポーネントを用いて応用開発](application.md)  
[Step5: FPGAとCPUをつなぐインターフェイスの記述体験](interface_description.md)  


## 実験をする上でのTips

**Zedboard上の時間の設定**  
dateコマンドで時間の設定を行う 書式`date MMDDHHmm[[CC]YY]`  
例は2016年5月24日15：30のとき  
```
$ date 052415302016
```

**ssh接続**  
コンソールが1つで足りない際は以下のコマンドでssh接続が可能です。  

```
$ ssh ubuntu@IP_address_on_Zedboard
```

**各ファイルの編集方法**  
Zedboard上のLinuxにはemacsもインストールされていますのでそちらでもファイルの編集ができます。  
**ファイル編集はssh接続したコンソールにおいて行う方が動作が安定しますので，ssh接続したコンソールでおこなってください**

**サイト中のファイル編集について**  
ファイル編集について以下のような表現があります。

```diff
-　削除
+　追加
```
